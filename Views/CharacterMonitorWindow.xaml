<Window x:Class="FFXIManager.Views.CharacterMonitorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="FFXI Characters" Height="300" Width="100"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        MinHeight="300" MinWidth="100"
        Background="{DynamicResource BackgroundBrush}">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Compact Header -->
        <Border Grid.Row="0" Background="{DynamicResource HeaderBackgroundBrush}" Padding="5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Center">
                    <ToggleButton x:Name="AlwaysOnTopToggle" 
                                  Content="📌" 
                                  ToolTip="Always On Top"
                                  Style="{StaticResource IconToggleButton}"
                                  Width="25" Height="15" 
                                  FontSize="9"
                                  Margin="0,0,2,0"
                                  Checked="AlwaysOnTopToggle_Checked"
                                  Unchecked="AlwaysOnTopToggle_Unchecked"/>
                    
                    <Button Content="❌" 
                            Click="CloseButton_Click"
                            ToolTip="Close"
                            Style="{StaticResource DangerIconButton}"
                            Width="25" Height="15"
                            FontSize="9"/>

                    <Button Content="🔄"
                        Command="{Binding RefreshCharactersCommand}"
                        Style="{StaticResource InfoIconButton}"
                        Width="25" Height="15"
                        FontSize="8"
                        ToolTip="Refresh"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Compact Character List -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <ItemsControl ItemsSource="{Binding Characters}" Margin="3">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" Margin="0,0,0,2" Padding="3" CornerRadius="2">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="{DynamicResource CardBackgroundBrush}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsActive}" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
                                            <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                                            <Setter Property="BorderThickness" Value="2"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsResponding}" Value="False">
                                            <Setter Property="Background" Value="{DynamicResource PillBackgroundBrush}"/>
                                            <Setter Property="BorderBrush" Value="{DynamicResource DangerBrush}"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Character Name - Compact -->
                                <StackPanel Grid.Row="0" Orientation="Horizontal">
                                    <Ellipse Width="6" Height="6" 
                                             Fill="{Binding StatusColor}" 
                                             VerticalAlignment="Center" Margin="0,0,3,0"/>
                                    <TextBlock Text="{Binding DisplayName}" 
                                               FontWeight="Bold" FontSize="10" 
                                               TextTrimming="CharacterEllipsis"
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource PrimaryTextBrush}"/>
                                </StackPanel>
                                
                                <!-- Compact Activate Button -->
                                <Button Grid.Row="1" 
                                        Margin="0,2,0,0"
                                        FontSize="9"
                                        Height="18"
                                        Width="80"
                                        HorizontalAlignment="Stretch"
                                        Command="{Binding DataContext.ActivateCharacterCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding}">
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource ModernButtonBase}">
                                            <Setter Property="Content" Value="🎯 Switch"/>
                                            <Setter Property="Background" Value="{StaticResource SuccessBrush}"/>
                                            <Setter Property="Padding" Value="2"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                    <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
                                                    <Setter Property="Content" Value="✓ Active"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsResponding}" Value="False">
                                                    <Setter Property="Background" Value="{StaticResource DangerBrush}"/>
                                                    <Setter Property="Content" Value="⚠️ Dead"/>
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                </DataTrigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="{StaticResource SuccessHoverBrush}"/>
                                                </Trigger>
                                                <MultiDataTrigger>
                                                    <MultiDataTrigger.Conditions>
                                                        <Condition Binding="{Binding IsMouseOver, RelativeSource={RelativeSource Self}}" Value="True"/>
                                                        <Condition Binding="{Binding IsActive}" Value="True"/>
                                                    </MultiDataTrigger.Conditions>
                                                    <Setter Property="Background" Value="{StaticResource PrimaryHoverBrush}"/>
                                                </MultiDataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
        
        <!-- No Characters Message - Compact -->
        <Border Grid.Row="1" 
                Background="{DynamicResource SurfaceBrush}"
                Margin="5"
                Padding="10">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding CharacterCount}" Value="0">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="🎮" FontSize="24" HorizontalAlignment="Center" Opacity="0.5"/>
                <TextBlock Text="No characters" 
                           FontSize="10" FontWeight="Bold" 
                           HorizontalAlignment="Center" Margin="0,5,0,2"
                           Foreground="{DynamicResource PrimaryTextBrush}"/>
                <TextBlock Text="Launch FFXI"
                           FontSize="9" Foreground="{DynamicResource SecondaryTextBrush}"
                           HorizontalAlignment="Center" 
                           TextWrapping="Wrap" 
                           TextAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>