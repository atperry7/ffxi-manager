<UserControl x:Class="FFXIManager.Views.ProfileActionsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:FFXIManager.Converters">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        
        <!-- Custom styles for conditional formatting -->
        <Style x:Key="LaunchButtonStyle" TargetType="Button" BasedOn="{StaticResource SuccessIconButton}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsEnabled}" Value="False">
                    <Setter Property="Background" Value="#9CA3AF"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding ExecutableExists}" Value="False">
                    <Setter Property="Background" Value="#F59E0B"/>
                    <Setter Property="ToolTip" Value="Executable not found - click to configure path"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="MonitorToggleStyle" TargetType="ToggleButton" BasedOn="{StaticResource IconToggleButton}">
            <Setter Property="Content" Value="⏸️"/>
            <Setter Property="ToolTip" Value="Auto-monitoring paused (click to resume)"/>
            <Style.Triggers>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="Content" Value="▶️"/>
                    <Setter Property="ToolTip" Value="Auto-monitoring active (click to pause)"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="ActivateButtonStyle" TargetType="Button" BasedOn="{StaticResource PrimaryIconButton}">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsActive, FallbackValue=False}" Value="True">
                    <Setter Property="Background" Value="#10B981"/>
                    <Setter Property="ToolTip" Value="Currently Active"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding IsResponding, FallbackValue=True}" Value="False">
                    <Setter Property="Background" Value="#EF4444"/>
                    <Setter Property="ToolTip" Value="Character Not Responding"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel>
            <!-- Application Manager -->
            <GroupBox Header="🚀 Application Manager" Margin="0,0,0,10">
                <StackPanel>
                    <!-- Application List -->
                    <ItemsControl ItemsSource="{Binding ExternalApplications}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="#E5E7EB" BorderThickness="1" Margin="0,4" Padding="12" Background="#F9FAFB" CornerRadius="8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Ellipse Grid.Column="0" Width="12" Height="12" Margin="0,0,12,0"
                                                 VerticalAlignment="Center"
                                                 Fill="{Binding StatusColor}"/>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="13" FontFamily="Segoe UI" Foreground="#111827"/>
                                            <TextBlock Text="{Binding StatusText}" FontSize="11" Foreground="#6B7280" Margin="0,2,0,0" FontFamily="Segoe UI"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                                            <Button Content="▶️"
                                                    Style="{StaticResource LaunchButtonStyle}"
                                                    Command="{Binding DataContext.LaunchApplicationCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="Launch Application"/>
                                            <Button Content="⏹️"
                                                    Style="{StaticResource DangerIconButton}"
                                                    Command="{Binding DataContext.KillApplicationCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="Stop Application"
                                                    IsEnabled="{Binding IsRunning}"/>
                                            <Button Content="⚙️"
                                                    Style="{StaticResource WarningIconButton}"
                                                    Command="{Binding DataContext.EditApplicationCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="Edit Application"/>
                                            <Button Content="🗑️"
                                                    Style="{StaticResource SecondaryIconButton}"
                                                    Command="{Binding DataContext.RemoveApplicationCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="Remove Application"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <!-- Application control buttons -->
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0" HorizontalAlignment="Right">
                        <Button Content="➕" 
                                Style="{StaticResource PrimaryIconButton}"
                                Command="{Binding AddApplicationCommand}"
                                ToolTip="Add Application"/>
                        <Button Content="🔄" 
                                Style="{StaticResource InfoIconButton}"
                                Command="{Binding RefreshApplicationsCommand}"
                                ToolTip="Refresh Status"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- PlayOnline Character Monitor -->
            <GroupBox Header="🎮 Character Monitor">
                <StackPanel>
                    <!-- Monitor Status -->
                    <Grid Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="📊 " FontSize="14" VerticalAlignment="Center" FontFamily="Segoe UI"/>
                            <TextBlock Text="{Binding PlayOnlineMonitor.MonitoringStatus, FallbackValue='Not Available'}" 
                                       FontWeight="SemiBold" VerticalAlignment="Center" FontSize="13" FontFamily="Segoe UI" Foreground="#111827"/>
                            <TextBlock Text=" | " Margin="8,0" VerticalAlignment="Center" Foreground="#6B7280"/>
                            <TextBlock Text="{Binding PlayOnlineMonitor.CharacterCount, FallbackValue=0}" 
                                       FontWeight="SemiBold" VerticalAlignment="Center" FontSize="13" FontFamily="Segoe UI" Foreground="#059669"/>
                            <TextBlock Text=" character(s)" VerticalAlignment="Center" FontSize="13" FontFamily="Segoe UI" Foreground="#6B7280"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Content="🔄" 
                                    Style="{StaticResource SuccessIconButton}"
                                    Command="{Binding PlayOnlineMonitor.RefreshCharactersCommand}"
                                    ToolTip="Refresh Characters"/>
                            <Button Content="📱" 
                                    Style="{StaticResource InfoIconButton}"
                                    Command="{Binding PlayOnlineMonitor.ShowCharacterMonitorCommand}"
                                    ToolTip="Open Character Monitor Window"/>
                            <ToggleButton IsChecked="{Binding PlayOnlineMonitor.IsMonitoring, FallbackValue=True}"
                                          Style="{StaticResource MonitorToggleStyle}"/>
                        </StackPanel>
                    </Grid>

                    <!-- Character List - Auto height -->
                    <ItemsControl ItemsSource="{Binding PlayOnlineMonitor.Characters}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="#E5E7EB" BorderThickness="1" Margin="0,4" Padding="12" CornerRadius="8">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="#F0F9FF"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsActive, FallbackValue=False}" Value="True">
                                                    <Setter Property="Background" Value="#DBEAFE"/>
                                                    <Setter Property="BorderBrush" Value="#3B82F6"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsResponding, FallbackValue=True}" Value="False">
                                                    <Setter Property="Background" Value="#F3F4F6"/>
                                                    <Setter Property="BorderBrush" Value="#9CA3AF"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                                                                
                                        <!-- Status Indicator -->
                                        <Ellipse Grid.Column="0" Width="12" Height="12" Margin="0,0,12,0"
                                                 VerticalAlignment="Center"
                                                 Fill="{Binding StatusBrush, FallbackValue=Gray}"/>
                                        
                                        <!-- Character Info -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding DisplayName, FallbackValue='Unknown Character'}" 
                                                       FontWeight="SemiBold" FontSize="13" FontFamily="Segoe UI" Foreground="#111827"/>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding StatusText, FallbackValue='Unknown'}" 
                                                           FontSize="11" Foreground="#6B7280" FontFamily="Segoe UI"/>
                                                <TextBlock Text=" | PID: " FontSize="11" Foreground="#6B7280" FontFamily="Segoe UI"/>
                                                <TextBlock Text="{Binding ProcessId, FallbackValue=0}" 
                                                           FontSize="11" Foreground="#6B7280" FontFamily="Segoe UI"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <!-- Activate Button -->
                                        <Button Grid.Column="2" Content="🎯"
                                                Style="{StaticResource ActivateButtonStyle}"
                                                Command="{Binding DataContext.PlayOnlineMonitor.ActivateCharacterCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                ToolTip="Activate Character Window"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- No Characters Message -->
                    <Border BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="8" Padding="24" Background="#F9FAFB">
                        <TextBlock Text="No PlayOnline characters detected. Launch FFXI to see character instances here."
                                   HorizontalAlignment="Center"
                                   FontStyle="Italic"
                                   Foreground="#6B7280"
                                   FontFamily="Segoe UI"
                                   FontSize="12"
                                   TextWrapping="Wrap"
                                   TextAlignment="Center">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding PlayOnlineMonitor.CharacterCount, FallbackValue=0}" Value="0">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Border>
                </StackPanel>
            </GroupBox>
        </StackPanel>
    </ScrollViewer>
</UserControl>